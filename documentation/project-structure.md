# מבנה הפרויקט

## תיקיות ראשיות

### src/
התיקייה המרכזית של קוד המקור בפרויקט.

- `types.ts`: קובץ הטיפוסים הראשי של הפרויקט - מכיל את כל ההגדרות של ממשקים וטיפוסים המשמשים את המערכת
- `config.ts`: ניהול הגדרות המערכת - טעינה ושמירה של הגדרות, קבלת רשימת סרטונים ממקורות שונים

#### src/lib/
מכיל את הלוגיקה העסקית המרכזית של הפרויקט:
- `game-handler.ts`: אחראי על ניהול האינטראקציה עם המשחקים
- `game-config.ts`: הגדרות ספציפיות למשחקים שונים
- `get-game-config.ts`: טעינת והחלת הגדרות משחק
- `script-element-injection.ts`: לוגיקת הזרקת הקוד לדף המשחק
- `inject-code-into-function.ts`: הזרקת קוד לתוך פונקציות קיימות
- `fully-kiosk.ts`: ממשק לאפליקציית Fully Kiosk Browser
  - גישה לקבצי MP4 מתיקיית Movies של המכשיר
  - יצירת כתובות URL מקומיות לקבצי וידאו
  - המרת קבצים ל-Blob לצפייה מקומית
  - ניהול זיכרון על ידי שחרור משאבי Blob
- `google-drive-video.ts`: טיפול בסרטונים מ-Google Drive
  - חילוץ מזהה תיקייה מ-URL של גוגל דרייב
  - קבלת רשימת קבצים מתיקייה
  - יצירת כתובות URL לגישה ישירה לסרטונים
  - שימוש ב-Google Drive API עם מפתח API
- `logger.svelte.ts`: מערכת לוגים מותאמת לקומפוננטות Svelte

#### src/lib/utils/
כלי עזר שימושיים:
- `ms-to-time.ts`: המרת מילישניות לפורמט זמן קריא
- `shuffle-array.ts`: ערבוב מערכים באופן אקראי

#### src/UI/
מכיל את כל רכיבי ממשק המשתמש:
- `Main.svelte`: הקומפוננטה הראשית של האפליקציה
  - ניהול הצגת הסרטונים והמעבר ביניהם
  - טיימר לסגירה אוטומטית של הסרטונים
  - תמיכה בהצגת סרטונים מקומיים דרך Fully Kiosk
  - ממשק שליטה להצגה והסתרת הסרטונים
- `SettingsPage.svelte`: עמוד ההגדרות
- `components/`: רכיבי Svelte השונים
  - `Modal.svelte`: חלון קופץ להצגת תוכן
  - `Settings.svelte`: טופס הגדרות המערכת
    - הגדרת מקור הסרטונים (מקומי/גוגל דרייב/יוטיוב)
    - הגדרת זמן הצגת הסרטון
    - הגדרת תדירות הצגת הסרטונים (כל כמה סיבובים)
    - הגדרת הסתרת פס התקדמות
  - `VideoDialog.svelte`: רכיב להצגת סרטונים מקומיים וגוגל דרייב
    - נגן וידאו מותאם עם בקרים מוגבלים
    - תמיכה בהסתרת פס התקדמות
    - אנימציית טעינה וטיפול בשגיאות
    - מעקב אחר זמן נותר להצגה
  - `YoutubeDialog.svelte`: רכיב ייעודי לסרטוני YouTube (בפיתוח)
  - `LoadingSpinner.svelte`: אנימציית טעינה
  - `LeftButton.svelte`: כפתור ניווט

### game-analysis/
כלים לניתוח משחקים:
- `src/games.ts`: הגדרות והתאמות למשחקים ספציפיים
- `src/get-games-list.ts`: איסוף רשימת המשחקים הזמינים
- `src/types.ts`: הגדרות טיפוסים לניתוח משחקים

### dev/
כלי פיתוח ובדיקה:
- קבצי SVG לעיצוב חלונות קופצים
- דפי HTML לבדיקת עיצובים
- סקריפטים שונים לפיתוח

## קבצי תצורה

### קבצי TypeScript
- `tsconfig.json`: הגדרות קומפילציה ל-TypeScript
- `tsconfig.node.json`: הגדרות נוספות ל-TypeScript בסביבת Node.js

### קבצי עיצוב
- `tailwind.config.js`: הגדרות Tailwind CSS
- `postcss.config.js`: הגדרות PostCSS

### קבצי בנייה
- `vite.config.ts`: הגדרות כלי הבנייה Vite
- `svelte.config.js`: הגדרות Svelte

## תהליך העבודה

### קונפיגורציית משחקים
- כל משחק מוגדר עם הפרמטרים הבאים:
  - שם המשחק (באנגלית ובעברית)
  - פונקציית הטריגר להפעלת הסרטון
  - זמן השהייה לפני הצגת הסרטון
  - נתיב ה-URL של המשחק

- הגדרת ברירת מחדל למשחקים לא מוגדרים:
  - שם: 'default'
  - פונקציית טריגר: makeNewTurn
  - זמן השהייה: 100 מילישניות
  - נתיב URL: ללא

- פונקציות טריגר אפשריות:
  - makeNewTurn: סיום תור במשחק
  - playEndLevelAnimation: סיום שלב במשחק
  - makeMovie/makeBigMovie: הפעלת אנימציה
  - onShowAnimation/onStartAnim: התחלת אנימציה

### הזרקת קוד
1. זיהוי המשחק הנוכחי:
   - בדיקת נתיב ה-URL של הדף הנוכחי
   - חיפוש התאמה בין הנתיב לרשימת המשחקים המוגדרים
   - שימוש בהגדרות ברירת המחדל אם לא נמצאה התאמה
2. טעינת התצורה המתאימה מתוך רשימת המשחקים הנתמכים
3. הזרקת הקוד לפונקציית המטרה:
   - איתור הפונקציה לפי נתיב מלא (למשל: PIXI.game.state.states.game.makeNewTurn)
   - עטיפת הפונקציה המקורית בפונקציה חדשה
   - הוספת קוד לפני ואחרי הפעלת הפונקציה המקורית
   - שמירה על הקונטקסט המקורי של הפונקציה
4. הפעלת מנגנון המעקב אחר התקדמות המשחק

### הצגת סרטונים
1. זיהוי השלמת משימה במשחק
2. המתנה לדיליי שהוגדר בקונפיג המשחק
3. בחירת סרטון מתאים
4. הצגת החלון הקופץ
5. המתנה למשך זמן הצגת הסרטון שהוגדר בהגדרות
6. סגירה אוטומטית של החלון
7. המתנה לדיליי קבוע (2.5 שניות) לפני המשך המשחק

הערות:
- בסיבוב המשחק הראשון לא מוצג סרטון
- הצגת הסרטונים מותאמת לכל משחק בנפרד דרך קובץ הקונפיגורציה שלו
- ניתן להגדיר כל כמה סיבובי משחק יוצג סרטון (ברירת המחדל היא בכל סיבוב)

### ניתוח משחקים
1. סריקת משחקים זמינים
2. ניתוח נקודות התערבות אפשריות
3. יצירת תצורה מתאימה לכל משחק
