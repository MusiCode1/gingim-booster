# ארכיטקטורת המערכת

## סקירה כללית
שרת פרוקסי לסרטונים מגוגל דרייב המאפשר צפייה ישירה בסרטונים דרך ממשק REST API. השרת מממש מנגנון קאש לשיפור ביצועים ומשתמש ב-Fastify כמסגרת העבודה המרכזית.

## רכיבי המערכת

### 1. שרת Fastify (`app.ts`)
- נקודת הכניסה הראשית למערכת
- הגדרת תצורת השרת
- רישום פלאגינים וראוטרים
- ניהול שגיאות גלובלי

### 2. פלאגינים (`plugins/`)

#### פלאגין Google Drive (`drive.plugin.ts`)
- תקשורת מול Google Drive API
- ניהול אימות והרשאות
- הורדת סרטונים והזרמתם
- טיפול בשגיאות API

#### פלאגין קאש (`cache.plugin.ts`)
- ניהול מטמון זמני לסרטונים
- מדיניות שמירה וניקוי
- אופטימיזציה של שימוש בזיכרון

### 3. נתיבים (`routes/`)

#### נתיבי וידאו (`video.routes.ts`)
- `GET /video/:fileId` - קבלת סרטון לפי מזהה
- `GET /video/:fileId/info` - קבלת מידע על סרטון
- תמיכה בפרמטרים:
  * `quality` - איכות הסרטון (high/medium/low)
  * `timestamp` - נקודת התחלה בסרטון

### 4. קונפיגורציה (`config/`)

#### הגדרות מערכת (`config.ts`)
- משתני סביבה
- הגדרות Google Drive
- הגדרות קאש
- הגדרות שרת

## זרימת מידע
1. בקשת לקוח מגיעה לנתיב `/video/:fileId`
2. בדיקה האם הסרטון קיים במטמון
3. אם קיים - הזרמה ישירה מהמטמון
4. אם לא קיים:
   - פנייה ל-Google Drive
   - הזרמת הסרטון ללקוח
   - שמירה במטמון (אם עומד בקריטריונים)

## אבטחה
- הגבלת CORS
- Rate Limiting לבקשות
- ניהול מאובטח של מפתחות API
- Timeout לבקשות ארוכות

## ניהול שגיאות
- טיפול בשגיאות Google Drive
- טיפול בקבצים לא קיימים
- טיפול בשגיאות הזרמה
- לוגים מפורטים

## ביצועים
- מטמון זמני לשיפור זמני תגובה
- סטרימינג יעיל של קבצים גדולים
- ניהול חכם של זיכרון
- מדיניות פינוי מטמון אוטומטית
